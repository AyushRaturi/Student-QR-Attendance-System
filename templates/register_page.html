{% extends "base.html" %}

{% block title %}Student Registration{% endblock %}

{% block content %}
<style>
.wave-group {
  position: relative;
  margin-bottom: 30px;
}

.wave-group .input {
  font-size: 16px;
  padding: 10px 10px 10px 5px;
  display: block;
  width: 100%;
  border: none;
  border-bottom: 1px solid #515151;
  background: transparent;
}

.wave-group .input:focus {
  outline: none;
}

.wave-group .label {
  color: #999;
  font-size: 18px;
  font-weight: normal;
  position: absolute;
  pointer-events: none;
  left: 5px;
  top: 10px;
  display: flex;
}

.wave-group .label-char {
  transition: 0.2s ease all;
  transition-delay: calc(var(--index) * .05s);
}

.wave-group .input:focus ~ label .label-char,
.wave-group .input:valid ~ label .label-char {
  transform: translateY(-20px);
  font-size: 14px;
  color: #5264AE;
}

.wave-group .bar {
  position: relative;
  display: block;
  width: 100%;
}

.wave-group .bar:before,.wave-group .bar:after {
  content: '';
  height: 2px;
  width: 0;
  bottom: 1px;
  position: absolute;
  background: #5264AE;
  transition: 0.2s ease all;
  -moz-transition: 0.2s ease all;
  -webkit-transition: 0.2s ease all;
}

.wave-group .bar:before {
  left: 50%;
}

.wave-group .bar:after {
  right: 50%;
}

.wave-group .input:focus ~ .bar:before,
.wave-group .input:focus ~ .bar:after {
  width: 50%;
}

.register-button {
  font-family: inherit;
  font-size: 20px;
  background: #212121;
  color: white;
  fill: rgb(155, 153, 153);
  padding: 0.7em 1em;
  padding-left: 0.9em;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border: none;
  border-radius: 15px;
  font-weight: 1000;
  width: 100%;
  margin-top: 20px;
}

.register-button span {
  display: block;
  margin-left: 0.3em;
  transition: all 0.3s ease-in-out;
}

.register-button svg {
  display: block;
  transform-origin: center center;
  transition: transform 0.3s ease-in-out;
}

.register-button:hover {
  background: #000;
}

.register-button:hover .svg-wrapper {
  transform: scale(1.25);
  transition: 0.5s linear;
}

.register-button:hover svg {
  transform: translateX(1.2em) scale(1.1);
  fill: #fff;
}

.register-button:hover span {
  opacity: 0;
  transition: 0.5s linear;
}

.register-button:active {
  transform: scale(0.95);
}
</style>

<div class="row">
    <div class="col-lg-6 offset-lg-3 col-md-8 offset-md-2 col-12">
        <h2 class="text-center mb-4">Student Registration & QR Generator</h2>
        
        <form id="registerForm" class="mt-4">
            <div class="wave-group">
                <input required type="text" class="input" id="roll_no">
                <span class="bar"></span>
                <label class="label">
                    <span class="label-char" style="--index: 0">R</span>
                    <span class="label-char" style="--index: 1">o</span>
                    <span class="label-char" style="--index: 2">l</span>
                    <span class="label-char" style="--index: 3">l</span>
                    <span class="label-char" style="--index: 4"> </span>
                    <span class="label-char" style="--index: 5">N</span>
                    <span class="label-char" style="--index: 6">u</span>
                    <span class="label-char" style="--index: 7">m</span>
                    <span class="label-char" style="--index: 8">b</span>
                    <span class="label-char" style="--index: 9">e</span>
                    <span class="label-char" style="--index: 10">r</span>
                </label>
            </div>
            
            <div class="wave-group">
                <input required type="text" class="input" id="name">
                <span class="bar"></span>
                <label class="label">
                    <span class="label-char" style="--index: 0">S</span>
                    <span class="label-char" style="--index: 1">t</span>
                    <span class="label-char" style="--index: 2">u</span>
                    <span class="label-char" style="--index: 3">d</span>
                    <span class="label-char" style="--index: 4">e</span>
                    <span class="label-char" style="--index: 5">n</span>
                    <span class="label-char" style="--index: 6">t</span>
                    <span class="label-char" style="--index: 7"> </span>
                    <span class="label-char" style="--index: 8">N</span>
                    <span class="label-char" style="--index: 9">a</span>
                    <span class="label-char" style="--index: 10">m</span>
                    <span class="label-char" style="--index: 11">e</span>
                </label>
            </div>
            
            <button type="submit" class="register-button">
                <div class="svg-wrapper-1">
                    <div class="svg-wrapper">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="30" height="30" class="icon">
                            <path fill="currentColor" d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z">~</path>
                        </svg>
                    </div>
                </div>
                <span>Register & Generate QR</span>
            </button>
        </form>
        
        <div id="result" class="mt-4" style="display: none;">
            <div class="alert alert-success text-center">
                <h5>Student Registered Successfully!</h5>
                <div id="qrCode" class="mt-3"></div>
                <button class="btn btn-secondary mt-2" onclick="downloadQR()">Download QR Code</button>
                <br><small class="text-muted">QR code saved in qr_codes folder</small>
            </div>
        </div>
        
        <div id="error" class="mt-4" style="display: none;">
            <div class="alert alert-danger" id="errorMessage"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('registerForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = {
        roll_no: document.getElementById('roll_no').value,
        name: document.getElementById('name').value
    };
    
    try {
        const response = await fetch('/register', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });
        
        const result = await response.json();
        
        if (result.success) {
            document.getElementById('qrCode').innerHTML = 
                `<img src="data:image/png;base64,${result.qr_code}" alt="QR Code" class="img-fluid">`;
            document.getElementById('result').style.display = 'block';
            document.getElementById('error').style.display = 'none';
            document.getElementById('registerForm').reset();
        } else {
            document.getElementById('errorMessage').textContent = result.error;
            document.getElementById('error').style.display = 'block';
            document.getElementById('result').style.display = 'none';
        }
    } catch (error) {
        document.getElementById('errorMessage').textContent = 'Registration failed: ' + error.message;
        document.getElementById('error').style.display = 'block';
    }
});

function downloadQR() {
    const img = document.querySelector('#qrCode img');
    if (img) {
        const link = document.createElement('a');
        link.download = 'student-qr-code.png';
        link.href = img.src;
        link.click();
    }
}
</script>
{% endblock %}