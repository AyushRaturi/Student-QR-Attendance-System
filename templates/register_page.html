{% extends "base.html" %}

{% block title %}Student Registration{% endblock %}

{% block content %}
<style>
.wave-group {
  position: relative;
  margin-bottom: 30px;
}

.wave-group .input {
  font-size: 16px;
  padding: 10px 10px 10px 5px;
  display: block;
  width: 100%;
  border: none;
  border-bottom: 1px solid #515151;
  background: transparent;
}

.wave-group .input:focus {
  outline: none;
}

.wave-group .label {
  color: #999;
  font-size: 18px;
  font-weight: normal;
  position: absolute;
  pointer-events: none;
  left: 5px;
  top: 10px;
  display: flex;
}

.wave-group .label-char {
  transition: 0.2s ease all;
  transition-delay: calc(var(--index) * .05s);
}

.wave-group .input:focus ~ label .label-char,
.wave-group .input:valid ~ label .label-char {
  transform: translateY(-20px);
  font-size: 14px;
  color: #5264AE;
}

.wave-group .bar {
  position: relative;
  display: block;
  width: 100%;
}

.wave-group .bar:before,.wave-group .bar:after {
  content: '';
  height: 2px;
  width: 0;
  bottom: 1px;
  position: absolute;
  background: #5264AE;
  transition: 0.2s ease all;
  -moz-transition: 0.2s ease all;
  -webkit-transition: 0.2s ease all;
}

.wave-group .bar:before {
  left: 50%;
}

.wave-group .bar:after {
  right: 50%;
}

.wave-group .input:focus ~ .bar:before,
.wave-group .input:focus ~ .bar:after {
  width: 50%;
}

.register-button {
  font-family: inherit;
  font-size: 20px;
  background: #212121;
  color: white;
  fill: rgb(155, 153, 153);
  padding: 0.7em 1em;
  padding-left: 0.9em;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border: none;
  border-radius: 15px;
  font-weight: 1000;
  width: 100%;
  margin-top: 20px;
}

.register-button span {
  display: block;
  margin-left: 0.3em;
  transition: all 0.3s ease-in-out;
}

.register-button svg {
  display: block;
  transform-origin: center center;
  transition: transform 0.3s ease-in-out;
}

.register-button:hover {
  background: #000;
}

.register-button:hover .svg-wrapper {
  transform: scale(1.25);
  transition: 0.5s linear;
}

.register-button:hover svg {
  transform: translateX(1.2em) scale(1.1);
  fill: #fff;
}

.register-button:hover span {
  opacity: 0;
  transition: 0.5s linear;
}

.register-button:active {
  transform: scale(0.95);
}
</style>

<div class="row">
    <div class="col-md-6 offset-md-3">
        <h2 class="text-center mb-4">Student Registration & QR Generator</h2>
        
        <form id="registerForm" class="mt-4">
            <div class="wave-group">
                <input required type="text" class="input" id="roll_no">
                <span class="bar"></span>
                <label class="label">
                    <span class="label-char" style="--index: 0">R</span>
                    <span class="label-char" style="--index: 1">o</span>
                    <span class="label-char" style="--index: 2">l</span>
                    <span class="label-char" style="--index: 3">l</span>
                    <span class="label-char" style="--index: 4"> </span>
                    <span class="label-char" style="--index: 5">N</span>
                    <span class="label-char" style="--index: 6">u</span>
                    <span class="label-char" style="--index: 7">m</span>
                    <span class="label-char" style="--index: 8">b</span>
                    <span class="label-char" style="--index: 9">e</span>
                    <span class="label-char" style="--index: 10">r</span>
                </label>
            </div>
            
            <div class="wave-group">
                <input required type="text" class="input" id="name">
                <span class="bar"></span>
                <label class="label">
                    <span class="label-char" style="--index: 0">S</span>
                    <span class="label-char" style="--index: 1">t</span>
                    <span class="label-char" style="--index: 2">u</span>
                    <span class="label-char" style="--index: 3">d</span>
                    <span class="label-char" style="--index: 4">e</span>
                    <span class="label-char" style="--index: 5">n</span>
                    <span class="label-char" style="--index: 6">t</span>
                    <span class="label-char" style="--index: 7"> </span>
                    <span class="label-char" style="--index: 8">N</span>
                    <span class="label-char" style="--index: 9">a</span>
                    <span class="label-char" style="--index: 10">m</span>
                    <span class="label-char" style="--index: 11">e</span>
                </label>
            </div>
            
            <button type="submit" class="register-button">
                <div class="svg-wrapper-1">
                    <div class="svg-wrapper">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="30" height="30" class="icon">
                            <path d="M3,11H5V13H3V11M11,5H13V9H11V5M9,11H13V15H9V11M15,11H17V13H15V11M19,11H21V13H19V11M5,7H9V11H5V7M3,5H5V7H3V5M3,15H5V17H3V15M3,17H5V19H3V17M5,19H7V21H5V19M7,19H9V21H7V19M9,19H11V21H9V19M11,19H13V21H11V19M13,19H15V21H13V19M15,19H17V21H15V19M17,19H19V21H17V19M19,19H21V21H19V19M19,15H21V17H19V15M19,13H21V15H19V13M19,7H21V9H19V7M19,5H21V7H19V5M17,5H19V7H17V5M15,5H17V7H15V5M13,5H15V7H13V5M11,7H13V9H11V7M9,7H11V9H9V7M7,7H9V9H7V7M5,5H7V7H5V5M3,7H5V9H3V7M3,9H5V11H3V9M5,11H7V13H5V11M7,11H9V13H7V11M7,13H9V15H7V13M7,15H9V17H7V15M9,15H11V17H9V15M11,15H13V17H11V15M13,15H15V17H13V15M15,15H17V17H15V15M17,15H19V17H17V15M17,13H19V15H17V13M15,13H17V15H15V13M13,13H15V15H13V13M11,13H13V15H11V13M9,13H11V15H9V13M7,17H9V19H7V17M9,17H11V19H9V17M11,17H13V19H11V17M13,17H15V19H13V17M15,17H17V19H15V17M17,17H19V19H17V17"></path>
                        </svg>
                    </div>
                </div>
                <span>Register & Generate QR</span>
            </button>
        </form>
        
        <div id="result" class="mt-4" style="display: none;">
            <div class="alert alert-success text-center">
                <h5>Student Registered Successfully!</h5>
                <div id="qrCode" class="mt-3"></div>
                <button class="btn btn-secondary mt-2" onclick="downloadQR()">Download QR Code</button>
                <br><small class="text-muted">QR code saved in qr_codes folder</small>
            </div>
        </div>
        
        <div id="error" class="mt-4" style="display: none;">
            <div class="alert alert-danger" id="errorMessage"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('registerForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = {
        roll_no: document.getElementById('roll_no').value,
        name: document.getElementById('name').value
    };
    
    try {
        const response = await fetch('/register', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });
        
        const result = await response.json();
        
        if (result.success) {
            document.getElementById('qrCode').innerHTML = 
                `<img src="data:image/png;base64,${result.qr_code}" alt="QR Code" class="img-fluid">`;
            document.getElementById('result').style.display = 'block';
            document.getElementById('error').style.display = 'none';
            document.getElementById('registerForm').reset();
        } else {
            document.getElementById('errorMessage').textContent = result.error;
            document.getElementById('error').style.display = 'block';
            document.getElementById('result').style.display = 'none';
        }
    } catch (error) {
        document.getElementById('errorMessage').textContent = 'Registration failed: ' + error.message;
        document.getElementById('error').style.display = 'block';
    }
});

function downloadQR() {
    const img = document.querySelector('#qrCode img');
    if (img) {
        const link = document.createElement('a');
        link.download = 'student-qr-code.png';
        link.href = img.src;
        link.click();
    }
}
</script>
{% endblock %}