<!DOCTYPE html>
<html>
<head>
    <title>Subject Selection</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="row">
            <div class="col-md-6 offset-md-3">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h4>Subject Selection</h4>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Current Subject:</label>
                            <div class="alert alert-info" id="currentSubject">
                                Loading...
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="subjectSelect" class="form-label">Change Subject:</label>
                            <select class="form-select" id="subjectSelect">
                                <option value="">Loading subjects...</option>
                            </select>
                        </div>
                        
                        <button class="btn btn-success w-100" onclick="updateSubject()">Update Subject</button>
                        
                        <div class="mt-3">
                            <a href="/" class="btn btn-secondary w-100">Back to Main Page</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Load subjects on page load
        document.addEventListener('DOMContentLoaded', loadSubjects);
        
        async function loadSubjects() {
            try {
                const response = await fetch('/get-subjects');
                const data = await response.json();
                
                if (data.success) {
                    // Update current subject display
                    document.getElementById('currentSubject').innerHTML = 
                        `<strong>${data.current.subject_id}</strong> - ${data.current.subject_name}`;
                    
                    // Populate dropdown
                    const select = document.getElementById('subjectSelect');
                    select.innerHTML = '<option value="">Select a subject...</option>';
                    
                    data.subjects.forEach(subject => {
                        const option = document.createElement('option');
                        option.value = subject.subject_id;
                        option.textContent = `${subject.subject_id} - ${subject.subject_name}`;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Failed to load subjects:', error);
            }
        }
        
        async function updateSubject() {
            const selectedSubject = document.getElementById('subjectSelect').value;
            
            if (!selectedSubject) {
                alert('Please select a subject');
                return;
            }
            
            try {
                const response = await fetch('/set-subject', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ subject_id: selectedSubject })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Update current subject display
                    document.getElementById('currentSubject').innerHTML = 
                        `<strong>${result.current.subject_id}</strong> - ${result.current.subject_name}`;
                    
                    // Reset dropdown
                    document.getElementById('subjectSelect').value = '';
                    
                    alert('Subject updated successfully!');
                } else {
                    alert('Failed to update subject: ' + result.error);
                }
            } catch (error) {
                alert('Update failed: ' + error.message);
            }
        }
    </script>
</body>
</html>